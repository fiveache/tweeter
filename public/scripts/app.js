$(document).ready(()=>{const e=e=>{return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},t=(t,a,s)=>{let n=`\n    <article class="tweet" data-id="${t._id}">\n      <header class="clearfix">\n        <img class="user-avatar" src="${t.user.avatars.small}" alt="${e(t.user.name)}' Avatar">\n        <h2>${e(t.user.name)}</h2>\n        <h3>${e(t.user.handle)}</h3>\n      </header>\n      <p>${e(t.content.text)}</p>\n      <footer>\n        <span class="created-at">\n          ${Math.floor((Date.now()-new Date(t.created_at).getTime())/864e5)} Days Ago\n        </span>`;return a&&(n=`${n} <div class="tweet-icons"><span class="flag">🏳</span><span class="retweet">🎺</span><span class="like-count`,s.includes(t._id)&&(n=`${n} user-liked-tweet`),n=`${n}" data-ref="${t._id}">${t.likes||"0"} 👍 </span> </div>`),n=`${n}</footer></article>`},a=()=>$.ajax({type:"GET",url:"/tweets"}),s=e=>{$("#tweet-container").prepend(e)};$(".new-tweet form").on("submit",function(e){e.preventDefault();const n=$(this).serialize();$.ajax({type:"POST",url:"/tweets",data:n}).then(e=>{$(".new-tweet form textarea").val("").trigger("input"),a().then(e=>{const a=t(e.tweets[Object.keys(e.tweets).length-1],e.isLoggedIn,e.likes);s(a)})})}),$("span.compose-button").click(e=>{$("section.new-tweet").slideToggle(300,()=>{$("section.new-tweet textarea ").focus()})}),$("span.login-button").click(e=>{$("section.user-login").slideToggle(150,()=>{$(".user-login #username").focus()}),$("section.user-register").slideUp(150,()=>{})}),$("input.register-button").click(e=>{$("section.user-register").slideToggle(150,()=>{$(".user-login #username").focus()}),$("section.user-login").slideUp(150,()=>{})}),$("#tweet-container").on("click",".like-count",function(e){const t=$(e.target).data("ref");let a=Number($(e.target).text().match(/\d/g).join(""));$.ajax({type:"POST",url:"/tweets/like",data:{id:t}}).fail((t,a,s)=>{403===t.status?($(e.target).parent().parent().append("<span class='tweet-warning-area'></span>"),$(".tweet-warning-area").html("🚫 Can't like your own tweet!"),$(e.target).removeClass("like-count"),$(e.target).removeData("ref")):console.log(s)}).then((t,s,n)=>{t&&console.log(t),201===n.status&&(a++,$(e.target).text(`${a} 👍`),$(e.target).addClass("user-liked-tweet")),204===n.status&&(a--,$(e.target).text(`${a} 👍`),$(e.target).removeClass("user-liked-tweet"))})}),a().then(e=>{Object.keys(e.tweets).forEach(a=>{s(t(e.tweets[a],e.isLoggedIn,e.likes))})}),$(".register-area #username").focus()}),$(document).ready(()=>{const e=$("section.new-tweet textarea").siblings().filter(".counter");e.text(140);const t=$(".new-tweet form input");t.attr("disabled","disabled");const a=$("section span.warning-message");$("section.new-tweet textarea").on("input change ",s=>{const n=140-s.target.value.length;e.text(n),n<0?(e.css("color","red"),t.attr("disabled","disabled"),a.html("Your tweet is too long!")):140===n?(e.css("color","inherit"),t.attr("disabled","disabled"),a.html("What do you have to say?")):(e.css("color","inherit"),t.removeAttr("disabled"),a.html(""))})});